"use strict";(()=>{var e={};e.id=44,e.ids=[44,660],e.modules={3736:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>x,default:()=>h,getServerSideProps:()=>g,getStaticPaths:()=>m,getStaticProps:()=>p,reportWebVitals:()=>f,routeModule:()=>_,unstable_getServerProps:()=>y,unstable_getServerSideProps:()=>b,unstable_getStaticParams:()=>S,unstable_getStaticPaths:()=>j,unstable_getStaticProps:()=>v});var a=r(7093),i=r(5244),n=r(1323),l=r(9209),o=r.n(l),c=r(9597),d=r(5751),u=e([d]);d=(u.then?(await u)():u)[0];let h=(0,n.l)(d,"default"),p=(0,n.l)(d,"getStaticProps"),m=(0,n.l)(d,"getStaticPaths"),g=(0,n.l)(d,"getServerSideProps"),x=(0,n.l)(d,"config"),f=(0,n.l)(d,"reportWebVitals"),v=(0,n.l)(d,"unstable_getStaticProps"),j=(0,n.l)(d,"unstable_getStaticPaths"),S=(0,n.l)(d,"unstable_getStaticParams"),y=(0,n.l)(d,"unstable_getServerProps"),b=(0,n.l)(d,"unstable_getServerSideProps"),_=new a.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/community",pathname:"/community",bundlePath:"",filename:""},components:{App:c.default,Document:o()},userland:d});s()}catch(e){s(e)}})},3183:(e,t,r)=>{r.d(t,{Z:()=>ChatRoom});function ChatRoom(){return null}},7159:(e,t,r)=>{r.d(t,{a:()=>useAuth});var s=r(6689);function useAuth(){let[e,t]=(0,s.useState)(null),[r,a]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let e=localStorage.getItem("corks_token");e&&(t(e),fetch("/api/auth/me",{headers:{Authorization:"Bearer "+e}}).then(e=>e.json()).then(e=>{e&&!e.error&&a(e)}))},[]),{token:e,user:r,login:function(e,r){localStorage.setItem("corks_token",e),t(e),a(r)},logout:function(){localStorage.removeItem("corks_token"),t(null),a(null)}}}},5751:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>Community});var a=r(997),i=r(6689),n=r(8933),l=r(5941),o=r(3183),c=r(7159),d=e([l]);l=(d.then?(await d)():d)[0];let fetcher=e=>fetch(e).then(e=>e.json());function Community(){let{data:e,mutate:t}=(0,l.default)("/api/posts",fetcher),r=(0,c.a)(),[s,d]=(0,i.useState)("");async function publish(){s&&(await fetch("/api/posts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s,authorId:r?.user?.id})}),d(""),t())}return(0,a.jsxs)(n.Z,{children:[a.jsx("h2",{children:"社区"}),a.jsx("div",{className:"muted",children:"内容流：酒评 • 酒吧探店 • 聚会照片 • 问答"}),(0,a.jsxs)("div",{style:{marginTop:14},className:"card",children:[a.jsx("div",{style:{fontWeight:800},children:"发布新内容"}),a.jsx("textarea",{placeholder:"说点什么吧",value:s,onChange:e=>d(e.target.value),style:{width:"100%",marginTop:10,minHeight:80,padding:10}}),a.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8},children:a.jsx("button",{className:"btn",onClick:publish,children:"发布"})})]}),(0,a.jsxs)("div",{style:{marginTop:18},children:[a.jsx("h3",{children:"实时群聊"}),a.jsx(o.Z,{roomId:"general",user:r.user})]}),a.jsx("div",{style:{marginTop:18},children:e?a.jsx("div",{children:e.map(e=>a.jsx("div",{className:"card",style:{marginBottom:10},children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,a.jsxs)("div",{children:[a.jsx("div",{style:{fontWeight:800},children:e.author||"匿名"}),a.jsx("div",{className:"muted small",children:e.content})]}),a.jsx("div",{style:{textAlign:"right"},children:(0,a.jsxs)("div",{className:"muted small",children:["点赞 ",e.likes]})})]})},e.id))}):a.jsx("div",{className:"muted",children:"加载中…"})})]})}s()}catch(e){s(e)}})},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},5941:e=>{e.exports=import("swr")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},9955:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[209,130,424,909],()=>__webpack_exec__(3736));module.exports=r})();