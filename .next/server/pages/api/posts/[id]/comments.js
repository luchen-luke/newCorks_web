"use strict";(()=>{var e={};e.id=600,e.ids=[600],e.modules={9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9926:e=>{e.exports=import("zod")},8488:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>u,routeModule:()=>c});var n=r(1802),s=r(7153),i=r(6249),o=r(2668),d=e([o]);o=(d.then?(await d)():d)[0];let u=(0,i.l)(o,"default"),l=(0,i.l)(o,"config"),c=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/posts/[id]/comments",pathname:"/api/posts/[id]/comments",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},9823:(e,t,r)=>{r.d(t,{Q:()=>getUserFromHeader});var a=r(9344),n=r.n(a),s=r(9822);async function getUserFromHeader(e){let t=e.headers?.authorization||"",r=t.startsWith("Bearer ")?t.slice(7):null;if(!r)return null;try{let e=n().verify(r,process.env.JWT_SECRET||"dev-secret"),t=await s.Z.user.findUnique({where:{id:e.sub}});return t}catch(e){return null}}},9822:(e,t,r)=>{r.d(t,{Z:()=>i});let a=require("@prisma/client"),n=globalThis,s=n.prisma||new a.PrismaClient,i=s},2668:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>handler});var n=r(9822),s=r(9823),i=r(9926),o=e([i]);i=(o.then?(await o)():o)[0];let d=i.z.object({content:i.z.string().min(1)});async function handler(e,t){let{id:r}=e.query;if("GET"===e.method){let e=await n.Z.comment.findMany({where:{postId:String(r)},orderBy:{createdAt:"asc"},include:{author:!0}});t.status(200).json(e);return}let a=await (0,s.Q)(e);if(!a)return t.status(401).json({error:"unauthorized"});if("POST"===e.method){let s=d.safeParse(e.body);if(!s.success)return t.status(400).json({error:s.error.flatten()});try{let{content:e}=s.data,i=await n.Z.comment.create({data:{postId:String(r),authorId:a.id,content:e}});t.status(201).json(i)}catch(e){t.status(500).json({error:String(e)})}return}t.status(405).json({error:"method not allowed"})}a()}catch(e){a(e)}})}};var t=require("../../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[222],()=>__webpack_exec__(8488));module.exports=r})();