"use strict";(()=>{var e={};e.id=31,e.ids=[31],e.modules={1495:e=>{e.exports=require("ioredis")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9505:e=>{e.exports=import("socket.io")},4587:(e,o,t)=>{t.a(e,async(e,r)=>{try{t.r(o),t.d(o,{config:()=>d,default:()=>l,routeModule:()=>p});var n=t(1802),s=t(7153),a=t(6249),i=t(5857),c=e([i]);i=(c.then?(await c)():c)[0];let l=(0,a.l)(i,"default"),d=(0,a.l)(i,"config"),p=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/socket",pathname:"/api/socket",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},9822:(e,o,t)=>{t.d(o,{Z:()=>a});let r=require("@prisma/client"),n=globalThis,s=n.prisma||new r.PrismaClient,a=s},5857:(e,o,t)=>{t.a(e,async(e,r)=>{try{t.r(o),t.d(o,{default:()=>handler});var n=t(9505),s=t(9822),a=t(1495),i=t.n(a),c=e([n]);function handler(e,o){if(!o.socket.server.io){console.log("âœ¨ Socket.io server initializing...");let e=new n.Server(o.socket.server);if(process.env.REDIS_URL)try{new(i())(process.env.REDIS_URL),console.log("Connected to Redis for socket support")}catch(o){let e=o instanceof Error?o:Error(String(o));console.warn("Redis connection for socket adapter failed",e.message)}e.on("connection",o=>{console.log("Socket connected:",o.id),o.on("join",e=>{o.join(e)}),o.on("message",async({roomId:o,userId:t,text:r})=>{try{let n=await s.Z.message.create({data:{roomId:o,authorId:t||null,text:r}});e.to(o).emit("message",n)}catch(e){console.error("failed to save message",e)}}),o.on("disconnect",()=>{console.log("Socket disconnected:",o.id)})}),o.socket.server.io=e}o.end()}n=(c.then?(await c)():c)[0],r()}catch(e){r(e)}})}};var o=require("../../webpack-api-runtime.js");o.C(e);var __webpack_exec__=e=>o(o.s=e),t=o.X(0,[222],()=>__webpack_exec__(4587));module.exports=t})();